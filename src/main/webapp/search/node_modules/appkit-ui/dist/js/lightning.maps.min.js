/*! appkit-ui 2018-09-10 */
!function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){return{restrict:"E",scope:{options:"=?"},transclude:!0,controller:["$scope","$attrs",function(a,b){function c(e,f){"esri"==b.provider?null!=a.esri&&null!=a.esri.Point?a.createLayer(e,f):d(function(){c(e,f)},0):a.createLayer(e,f)}var e=this;e.addLayer=c}],link:{post:function(m,n,o,p,q){function r(){m.markers=[],C?o.addressField?"esri"==o.provider?I.geocodePoints(m.response,o):H.geocodeMarkers(m.response,o):w():s()}function s(){var b="";b+="esri"==o.provider?"<style>.map"+B+" .map{height:"+o.height+"; width:"+o.width+";}</style>":"<style>.map"+B+" .angular-google-map-container{height:"+o.height+"; width:"+o.width+";}</style>","esri"==o.provider?(b+='<div class="map'+B+'" style="height:'+o.height+"; width:"+o.width+'; position:relative;">',"true"==o.loadingOverlay&&(b+=u()),q(m,function(a){angular.forEach(a,function(a){"GEO:LAYER"!=a.nodeName&&"ESRI:WEBMAP"!=a.nodeName||(b+=a.outerHTML)})}),b+=v(),b+="</div>",n.html(b),a(n.contents())(m),C=!0):i.then(function(){b+='<div class="map'+B+'" style="height:'+o.height+"; width:"+o.width+'; position:relative;">',"true"==o.loadingOverlay&&(b+=u()),q(m,function(a){angular.forEach(a,function(a){"GEO:LAYER"==a.nodeName&&(b+=a.outerHTML)})}),b+=v(),b+="</div>",b+='<button ng-if="applyButton == true" ng-click="searchArea()" styling="button" style="margin-top:10px;">Search this Area</button>',n.html(b),a(n.contents())(m),C=!0})}function t(){switch(o.provider){case"google":H.fitBounds();break;case"esri":I.fitBounds();break;default:H.fitBounds()}}function u(){var a='<div class="loading-block-container" ng-show="loading"><div class="loading-block-overlay"></div><div class="loading-block-content"><div class="loading-block-message"><div class="tk-stl-circle-loader"></div></div></div></div>';return a}function v(){switch(o.provider){case"google":return H.createMap();case"esri":return z();default:return H.createMap()}}function w(){switch(o.provider){case"google":H.addMarkers(m.response,o);break;case"esri":I.addEsriMarkers(m.response,o);break;default:H.addMarkers(m.response,o)}}function x(a,b){switch(o.provider){case"google":H.addMarkers(a,b);break;case"esri":I.addEsriMarkers(a,b);break;default:H.addMarkers(a,b)}}function y(a){null!=o.longitudeField&&null!=o.latitudeField&&(l.removeFiltersFromUrl(o.latitudeField,!1),l.removeFiltersFromUrl(o.longitudeField,!1),l.addRangeFilterToUrl(o.latitudeField,a.swLat,a.neLat,a.swLat,a.neLat,!1),a.swLng>a.neLng?(l.addRangeFilterToUrl(o.longitudeField,a.swLng,"",a.swLng,"",!1,"value"),l.addRangeFilterToUrl(o.longitudeField,"",a.neLng,"",a.neLng,!0,"value")):l.addRangeFilterToUrl(o.longitudeField,a.swLng,a.neLng,a.swLng,a.neLng,!0))}function z(){var a='<esri-map id="esrimap"style="position: absolute; height: 100%; width: 100%;"';null!=o.webmapId&&(a+=' webmap-id="'+o.webmapId+'" '),a+='map-options="map.options" ng-if="loaded" load="onMapLoad"></esri-map>',m.loaded=!1,m.map={},o.javascriptApiUrl=null==o.javascriptApiUrl?"//js.arcgis.com/3.15compact":o.javascriptApiUrl,o.basemap=null==o.basemap?"topo":o.basemap;var b;return d(function(){b=angular.element(n).find("esri:webmap"),null!=b&&(b=b[0],null!=b&&null!=b.attributes&&(null!=b.attributes.id&&(m.webmapId=b.attributes.id.value),null!=b.attributes.portalUrl&&(m.portalUrl=b.attributes.portalUrl.value)))},0),h.bootstrap({url:o.javascriptApiUrl}).then(function(){m.loaded=!0,m.map.options={basemap:o.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"},null!=m.webmapId&&(m.map.options.webmapId=m.webmapId)},function(){m.loaded=!0,m.map.options={basemap:o.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"},null!=m.webmapId&&(m.map.options.webmapId=m.webmapId)}),m.onMapLoad=A,a}function A(a){h.require(["esri/toolbars/draw","esri/symbols/SimpleMarkerSymbol","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/graphic","esri/geometry/Point","esri/graphicsUtils","esri/InfoTemplate","dijit/layout/ContentPane","esri/arcgis/utils","esri/dijit/LayerList","esri/geometry/webMercatorUtils"],function(b,c,d,e,f,g,h,i,k,l,n,p){function q(b,c){if(t.deactivate(),a.setMapCursor("default"),b.srcElement.classList.remove("active"),b.srcElement.title=u,c){var d=p.xyToLngLat(c.geometry.getExtent().xmin,c.geometry.getExtent().ymin),e=p.xyToLngLat(c.geometry.getExtent().xmax,c.geometry.getExtent().ymax),f=p.xyToLngLat(c.geometry.getExtent().xmax,c.geometry.getExtent().ymin),g=p.xyToLngLat(c.geometry.getExtent().xmin,c.geometry.getExtent().ymax),h={neLat:e[1],neLng:e[0],swLat:d[1],swLng:d[0],nwLat:g[1],nwLng:g[0],seLat:f[1],seLng:f[0]};j.$broadcast("recentangle_drawn_esri",h),y(h)}}null!=m.portalUrl&&(l.arcgisUrl=m.portalUrl);var r=new n({map:a,layers:l.getLayerList(a)},"layerList");if(r.startup(),G.indexOf("draw")!=-1){var s,t=new b(a),u="Enable rectangle drawing",v="Disable rectangle drawing";dojo.create("div",{className:"esriSimpleSliderDrawButton",title:u,innerHTML:"&#x25A2;",style:"font-size: 18px; padding-top: 2px;",onclick:function(c){return s=c,c.srcElement.classList.contains("active")?void q(c):(t.activate(b.RECTANGLE),c.srcElement.classList.add("active"),c.srcElement.title=v,void a.setMapCursor("crosshair"))}},dojo.query(".esriSimpleSliderIncrementButton")[0],"after"),t.on("draw-end",function(a){q(s,a)})}m.esri={},m.esri.Point=g,I.modules.Draw=b,I.modules.SimpleMarkerSymbol=c,I.modules.PictureMarkerSymbol=d,I.modules.SimpleLineSymbol=e,I.modules.Graphic=f,I.modules.Point=g,I.modules.GraphicUtils=h,I.modules.InfoTemplate=i,I.map=a,null!=o.response&&(null!=o.addressField?I.geocodePoints(m.response,o):I.addEsriMarkers(m.response,o))})}var B=Math.floor(1e3*Math.random()+1);m.markers=[],m.$on("$destroy",function(){F()});var C=!1;o.height=null==o.height?"400px":o.height,o.width=null==o.width?"100%":o.width,o.scrollToZoom="true"==o.scrollToZoom,o.provider=o.provider||"google",m.createLayer=function(a,b){b.addressField?"esri"==o.provider?I.geocodePoints(a,b):H.geocodeMarkers(a,b):x(a,b)},null!=o.response?(m.response=k.getResponse(o.response),null!=m.response&&r(),m.$on(o.response+"_updated",function(a,b){null!=b&&(m.response=b,r())})):s(),m.$watch(function(){return n[0].offsetTop>0&&n[0].offsetLeft>0},function(){n[0].offsetTop>0&&n[0].offsetLeft>0&&t()});var D,E,F=m.$on("geoMap.resize",function(){t()}),G=[];null!=o.events&&(G=o.events.split(","));var H={map:!1,bounds:[],markers:[],createMap:function(){var a;m.loading=!0,a=null==o.basemap?google.maps.MapTypeId.ROADMAP:"satellite"==o.basemap.toLowerCase()?google.maps.MapTypeId.SATELLITE:"hybrid"==o.basemap.toLowerCase()?google.maps.MapTypeId.HYBRID:"terrain"==o.basemap.toLowerCase()?google.maps.MapTypeId.TERRAIN:google.maps.MapTypeId.ROADMAP,m.mapOptions={scrollwheel:o.scrollToZoom,mapTypeId:a},null!=m.options&&angular.extend(m.mapOptions,m.options),m.googlemap={};var b='<ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions" control="googlemap">';null!=o.response&&(o.addressField?H.geocodeMarkers(m.response,o):w()),b+='<ui-gmap-markers models="markers" coords="\'self\'" icon="\'icon\'" click="click" events="events">',b+="<ui-gmap-windows show=\"'infoWindow.show'\"><div ng-non-bindable>{{infoWindow.labelContent}}</div></ui-gmap-windows>",b+="</ui-gmap-markers>",b+="</ui-gmap-google-map>",m.map={center:{latitude:0,longitude:0},zoom:null==o.zoomLevel||isNaN(o.zoomLevel)?13:Number(o.zoomLevel)};for(var c=new google.maps.LatLngBounds,e=0;e<m.markers.length;e++)c.extend(new google.maps.LatLng(m.markers[e].latitude,m.markers[e].longitude));return m.googleBounds=c,d(function(){if(m.googlemap&&"function"==typeof m.googlemap.getGMap){var a=m.googlemap.getGMap();H.fitBounds(),d(function(){if(G.indexOf("draw")!=-1&&(D=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["rectangle"]}}),D.setMap(a)),1==m.markers.length||null!=o.zoomLevel&&m.map.zoom>o.zoomLevel)d(function(){1==m.markers.length&&isNaN(o.zoomLevel)?(a.setZoom(13),google.maps.event.trigger(a,"resize")):(a.setZoom(Number(o.zoomLevel)),google.maps.event.trigger(a,"resize"))},1e3);else{for(var b=new google.maps.LatLngBounds,c=0;c<m.markers.length;c++)b.extend(new google.maps.LatLng(m.markers[c].latitude,m.markers[c].longitude));m.googleBounds=b,H.fitBounds()}m.loading=!1},0)}},0),b},geocodeMarkers:function(a,b){for(var c=g.gmapAddresses||{},d=0;d<a.results.length;d++){var h=void 0!=a.results[d].result.fields[b.addressField]?f("actualValue")(a.results[d].result.fields[b.addressField].val):"";if(null!=c&&null!=c[h]){var i=H.createMarker(d,c[h].lat,c[h].lng,a,b);m.markers.push(i)}else null!=h&&""!=h.trim()?H.attemptGeocode(d,h,a,b):e.warn("Unable to render result "+(d+1)+" - No Address to Render")}H.setMarkerIds()},attemptGeocode:function(a,b,c,f){var h=new google.maps.Geocoder;h.geocode({address:b},function(h,i){if(i==google.maps.GeocoderStatus.OK){var j=H.createMarker(a,h[0].geometry.location.lat(),h[0].geometry.location.lng(),c,f);if(m.markers.push(j),a%10==0){for(var k=new google.maps.LatLngBounds,l=0;l<m.markers.length;l++)k.extend(new google.maps.LatLng(m.markers[l].latitude,m.markers[l].longitude));m.googleBounds=k,t()}var n=g.gmapAddresses||{};n[b]={lat:h[0].geometry.location.lat(),lng:h[0].geometry.location.lng()},g.gmapAddresses=n}else i==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?d(function(){H.attemptGeocode(a,b,c,f)},250):e.warn("Unable to render result "+(a+1)+" ("+b+") - "+i);H.setMarkerIds()})},createMarker:function(a,b,c,d,e){var g={id:null,latitude:b,longitude:c,title:"m"+a};if(null!=o.weightField){var h,i;angular.forEach(d.results,function(a){var b=f("actualValue")(a.result.fields[o.weightField].val);null==h||null==i?(h=b,i=b):h>b?h=b:i<b&&(i=b)});for(var j,k=i/10,l=f("actualValue")(d.results[a].result.fields[o.weightField].val),m=1;m<=10;){var n=k*(m-1),p=k*m;l>n&&l<=p&&(j=m*(1+3/m)+2),m++}null!=e.iconField&&null!=d.results[a].result.fields[e.iconField]?g.icon={url:f("actualValue")(d.results[a].result.fields[e.iconField].val),scaledSize:new google.maps.Size(5*j,5*j)}:null!=e.icon?g.icon={url:e.icon,scaledSize:new google.maps.Size(5*j,5*j)}:g.icon={path:google.maps.SymbolPath.CIRCLE,scale:j,strokeOpacity:.8,strokeColor:"#F7584C"}}else null!=e.iconField&&null!=d.results[a].result.fields[e.iconField]?g.icon=f("actualValue")(d.results[a].result.fields[e.iconField].val):null!=e.icon&&(g.icon=e.icon);return null!=e.urlField&&(g.click=function(){var b=null!=e.urlPrefix?e.urlPrefix:"";b+=null!=d.results[a].result.fields[e.urlField]?f("actualValue")(d.results[a].result.fields[e.urlField].val):"",window.open(b,void 0!=e.target?e.target:"_blank")}),null!=e.labelField&&(g.infoWindow={},g.infoWindow.show=!1,g.events={},g.events.mouseover=function(){g.show=!0},g.events.mouseout=function(){g.show=!1},g.infoWindow.labelContent=null!=d.results[a].result.fields[e.labelField]?f("actualValue")(d.results[a].result.fields[e.labelField].val):""),g},fitBounds:function(){if(m.googlemap&&"function"==typeof m.googlemap.getGMap){var a=m.googlemap.getGMap();(1!=m.eventsAdded||G.indexOf("zoom")==-1&&G.indexOf("drag")==-1&&G.indexOf("apply")==-1)&&(google.maps.event.trigger(a,"resize"),a.fitBounds(m.googleBounds)),d(function(){if(G.indexOf("drag")!=-1||G.indexOf("apply")!=-1){m.eventsAdded=!0;var b=a.addListener("dragend",function(){if(G.indexOf("drag")!=-1){var c=a.getBounds(),d=c.getNorthEast(),e=c.getSouthWest(),f=new google.maps.LatLng(d.lat(),e.lng()),g=new google.maps.LatLng(e.lat(),d.lng()),h={neLat:d.lat(),neLng:d.lng(),swLat:e.lat(),swLng:e.lng(),nwLat:f.lat(),nwLng:f.lng(),seLat:g.lat(),seLng:g.lng()};j.$broadcast("dragend_gmaps",h)}G.indexOf("apply")!=-1&&(m.applyButton=!0),google.maps.event.removeListener(b)})}if(m.searchArea=function(){var b=a.getBounds(),c=b.getNorthEast(),d=b.getSouthWest(),e=new google.maps.LatLng(c.lat(),d.lng()),f=new google.maps.LatLng(d.lat(),c.lng()),g={neLat:c.lat(),neLng:c.lng(),swLat:d.lat(),swLng:d.lng(),nwLat:e.lat(),nwLng:e.lng(),seLat:f.lat(),seLng:f.lng()};j.$broadcast("search_area_gmaps",g)},G.indexOf("zoom")!=-1||G.indexOf("apply")!=-1)var c=a.addListener("zoom_changed",function(){if(m.eventsAdded=!0,G.indexOf("zoom")!=-1){var b=a.getBounds(),d=b.getNorthEast(),e=b.getSouthWest(),f=new google.maps.LatLng(d.lat(),e.lng()),g=new google.maps.LatLng(e.lat(),d.lng()),h={neLat:d.lat(),neLng:d.lng(),swLat:e.lat(),swLng:e.lng(),nwLat:f.lat(),nwLng:f.lng(),seLat:g.lat(),seLng:g.lng()};j.$broadcast("zoom_changed_gmaps",h)}G.indexOf("apply")!=-1&&(m.applyButton=!0),google.maps.event.removeListener(c)});G.indexOf("draw")!=-1&&null==E&&(E=google.maps.event.addListener(D,"rectanglecomplete",function(a){var b=a.getBounds(),c=b.getNorthEast(),d=b.getSouthWest(),e=new google.maps.LatLng(c.lat(),d.lng()),f=new google.maps.LatLng(d.lat(),c.lng()),g={neLat:c.lat(),neLng:c.lng(),swLat:d.lat(),swLng:d.lng(),nwLat:e.lat(),nwLng:e.lng(),seLat:f.lat(),seLng:f.lng()};a.setMap(null),j.$broadcast("recentangle_drawn_gmaps",g),y(g)}))},2e3)}},addMarkers:function(a,b){for(var c=0;c<a.results.length;c++){var e=a.results[c].result.fields[b.latitudeField],g=a.results[c].result.fields[b.longitudeField];if(e&&g){var h,i,j;if(angular.isArray(e.val)&&angular.isArray(g.val))for(var k=Math.min(e.val.length,g.val.length),l=0;l<k;l++)h=f("actualValue")(e.val[l]),i=f("actualValue")(g.val[l]),j=H.createMarker(c,h,i,a,b),m.markers.push(j);else h=f("actualValue")(e.val),i=f("actualValue")(g.val),j=H.createMarker(c,h,i,a,b),m.markers.push(j);H.fitBounds()}}H.setMarkerIds(),d(function(){if(m.googlemap&&"function"==typeof m.googlemap.getGMap){var a=m.googlemap.getGMap();H.fitBounds(),d(function(){var b,c;if(G.indexOf("draw")!=-1&&(1==m.markers.length||null!=o.zoomLevel&&m.map.zoom>o.zoomLevel)){for(c=new google.maps.LatLngBounds,b=0;b<m.markers.length;b++)c.extend(new google.maps.LatLng(m.markers[b].latitude,m.markers[b].longitude));m.googleBounds=c,H.fitBounds(),d(function(){1==m.markers.length&&isNaN(o.zoomLevel)?(a.setZoom(13),google.maps.event.trigger(a,"resize")):(a.setZoom(Number(o.zoomLevel)),google.maps.event.trigger(a,"resize"))},1e3)}else if(G.indexOf("draw")!=-1){for(c=new google.maps.LatLngBounds,b=0;b<m.markers.length;b++)c.extend(new google.maps.LatLng(m.markers[b].latitude,m.markers[b].longitude));m.googleBounds=c,H.fitBounds()}m.loading=!1},0)}},0)},setMarkerIds:function(){angular.forEach(m.markers,function(a,b){a.id=b})}},I={map:!1,points:[],graphics:[],modules:{},markerSymbol:!1,createMap:z,mapLoaded:A,geocodePoints:function(a,h){var i=g.gmapAddresses||{};m.loading=!0;var j=[];o.geocodeServerUrl=null==o.geocodeServerUrl?"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/":o.geocodeServerUrl;for(var k=0;k<a.results.length;k++){var l=void 0!=a.results[k].result.fields[h.addressField]?f("actualValue")(a.results[k].result.fields[h.addressField].val):"";null!=i&&null!=i[l]?j.push(null):null==l||""==l.trim()?j.push(null):j.push(b.get(o.geocodeServerUrl+"find?text="+l+"&f=pjson"))}c.all(j).then(function(b){angular.forEach(b,function(b,c){var d,j=void 0!=a.results[c].result.fields[h.addressField]?f("actualValue")(a.results[c].result.fields[h.addressField].val):"";if(null==b&&null!=i&&null!=i[j])d={y:i[j].lat,x:i[j].lng};else{if(null==b)return void e.warn("Unable to render result "+(c+1)+" - No Address to Render");if(0==b.data.locations.length)return void e.warn("Unable to get coordinates for result "+(c+1));d=b.data.locations[0].feature.geometry,i=g.gmapAddresses||{},i[j]={lat:d.y,lng:d.x},g.gmapAddresses=i}var k={};if(k.pointAttrs={},null!=o.urlField){var l=null!=o.urlPrefix?o.urlPrefix:"";l+=null!=a.results[c].result.fields[h.urlField]?f("actualValue")(a.results[c].result.fields[h.urlField].val):"",k.pointAttrs.url=l}k.label=" ";var n=null!=a.results[c].result.fields[h.labelField]?f("actualValue")(a.results[c].result.fields[h.labelField].val):"";null!=n&&""!=n&&(k.label=n),k.header=" ";var p=null!=a.results[c].result.fields[h.labelHeaderField]?f("actualValue")(a.results[c].result.fields[h.labelHeaderField].val):"";null!=p&&""!=p&&(k.header=p),k.symbol=I.createMarkerSymbol(h,a,c),k.point=new I.modules.Point(d.x,d.y),m.markers.push(k)})}).then(function(){I.makeEsriGraphics(),I.map.graphics.clear();for(var a=0;a<I.graphics.length;a++)I.map.graphics.add(I.graphics[a]);try{d(function(){I.fitBounds()},300)}catch(b){I.makeEsriGraphics(),I.map.graphics.clear();for(var c=0;c<I.graphics.length;c++)I.map.graphics.add(I.graphics[c]);I.fitBounds()}})},makeEsriPoints:function(a,b){for(var c=0;c<a.results.length;c++)if(a.results[c].result.fields[b.latitudeField]&&a.results[c].result.fields[b.longitudeField]){var d=f("actualValue")(a.results[c].result.fields[b.latitudeField].val),e=f("actualValue")(a.results[c].result.fields[b.longitudeField].val),g={};if(g.pointAttrs={},null!=o.urlField){var h=null!=o.urlPrefix?o.urlPrefix:"";h+=null!=a.results[c].result.fields[b.urlField]?f("actualValue")(a.results[c].result.fields[b.urlField].val):"",g.pointAttrs.url=h}g.label=" ";var i=null!=a.results[c].result.fields[b.labelField]?f("actualValue")(a.results[c].result.fields[b.labelField].val):"";null!=i&&""!=i&&(g.label=i),g.header=" ";var j=null!=a.results[c].result.fields[b.labelHeaderField]?f("actualValue")(a.results[c].result.fields[b.labelHeaderField].val):"";null!=j&&""!=j&&(g.header=j),g.symbol=I.createMarkerSymbol(b,a,c),g.point=new I.modules.Point(e,d),m.markers.push(g)}return m.markers},makeEsriGraphics:function(){I.graphics=[];for(var a=0;a<m.markers.length;a++)if(I.graphics.push(new I.modules.Graphic(m.markers[a].point,m.markers[a].symbol)),I.graphics[a].setAttributes(m.markers[a].pointAttrs)," "!=m.markers[a].label||" "!=m.markers[a].header){var b=new I.modules.InfoTemplate(m.markers[a].header,m.markers[a].label);I.graphics[a].setInfoTemplate(b)}return dojo.connect(I.map.graphics,"onClick",function(a){null!=a.graphic.attributes.url&&window.open(a.graphic.attributes.url)}),dojo.connect(I.map.graphics,"onMouseMove",function(a){var b=a.graphic;null!=b.getContent()&&(this._map.infoWindow.setContent(b.getContent()),this._map.infoWindow.setTitle(b.getTitle()),this._map.infoWindow.show(a.screenPoint,this._map.getInfoWindowAnchor(a.screenPoint)))}),dojo.connect(I.map.graphics,"onMouseOut",function(){this._map.infoWindow.hide()}),I.graphics},addEsriMarkers:function(a,b){I.makeEsriPoints(a,b),I.makeEsriGraphics(),I.map.graphics.clear();for(var c=0;c<I.graphics.length;c++)I.map.graphics.add(I.graphics[c]);I.fitBounds()},fitBounds:function(){try{var a=I.modules.GraphicUtils.graphicsExtent(I.graphics);I.map.setExtent(a,!0),m.loading=!1}catch(b){m.loading=!1}},createMarkerSymbol:function(a,b,c){return null!=a.iconField&&null!=b.results[c].result.fields[a.iconField]?new I.modules.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:f("actualValue")(b.results[c].result.fields[a.iconField].val),width:24,height:24}):null!=a.icon?new I.modules.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:a.icon,width:24,height:24}):new I.modules.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",imageData:"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",contentType:"image/png",width:24,height:24})}}}}}}angular.module("lightning").directive("geoMap",a),a.$inject=["$compile","$http","$q","$timeout","$log","$filter","$localStorage","esriLoader","uiGmapGoogleMapApi","$rootScope","ResponseService","$lightningUrl"]}(),function(){"use strict";function a(a){var b={restrict:"E",transclude:!0,scope:{},require:"?^^geoMap",link:{post:function(b,c,d,e){d.response&&null!=e&&(b.response=a.getResponse(d.response),null!=b.response&&e.addLayer(b.response,d),b.$on(d.response+"_updated",function(a,c){b.response=c,e.addLayer(b.response,d)}))}}};return b}angular.module("lightning").directive("geoLayer",a),a.$inject=["ResponseService"]}(),function(){"use strict";function a(a,b,c){return{restrict:"E",scope:{options:"=?"},transclude:!0,link:function(d,e,f){function g(){if(d.facet=d.response.facets[f.facetName],null!=d.facet)if(h){if(null!=d.heatLayer){var a=[],c=new google.maps.LatLngBounds;angular.forEach(d.facet.filters,function(d){var e=b("actualValue")(d.val),f=e.split(","),g=f[0].trim(),h=f[1].trim();g=parseFloat(g),h=parseFloat(h);var i=new google.maps.LatLng(g,h);c.extend(i);var j={};j.location=i,j.weight=d.count,a.push(j)}),d.heatLayer.setData(a),d.googleBounds=c;var e=d.googlemap.getGMap();google.maps.event.trigger(e,"resize"),e.fitBounds(d.googleBounds)}}else d.mapOptions={scrollwheel:f.scrollToZoom},null!=d.options&&angular.extend(d.mapOptions,d.options),d.googlemap={},d.map={center:{latitude:38.9,longitude:-77.016},zoom:13,showHeat:!0,heatLayerCallback:function(a){var c=[],e=new google.maps.LatLngBounds;angular.forEach(d.facet.filters,function(a){var d=b("actualValue")(a.val),f=d.split(",");if(!(f.length<2)){var g=f[0].trim(),h=f[1].trim();g=parseFloat(g),h=parseFloat(h);var i=new google.maps.LatLng(g,h);e.extend(i);var j={};j.location=i,j.weight=a.count,c.push(j)}}),a.setData(c),d.googleBounds=e;var f=d.googlemap.getGMap();google.maps.event.trigger(f,"resize"),f.fitBounds(d.googleBounds),h=!0,d.heatLayer=a}}}var h=!1;f.scrollToZoom="true"==f.scrollToZoom,a.then(function(){d.response=c.getResponse(f.response),null!=d.response&&g(),d.$on(f.response+"_updated",function(a,b){d.response=b,g()})})},template:function(a,b){var c=Math.floor(1e3*Math.random()+1);b.height=null==b.height?"400px":b.height,b.width=null==b.width?"100%":b.width;var d="<style>.map"+c+" .angular-google-map-container{height:"+b.height+"; width:"+b.width+';}</style><div class="map'+c+'" style="height:'+b.height+"; width:"+b.width+'; position:relative;" ng-if="response != null"><ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions" control="googlemap" ng-if="map != null"><ui-gmap-layer namespace="visualization" type="HeatmapLayer" show="map.showHeat" onCreated="map.heatLayerCallback"></ui-gmap-layer></ui-gmap-google-map></div>';return d}}}angular.module("lightning").directive("geoHeatmap",a),a.$inject=["uiGmapGoogleMapApi","$filter","ResponseService"]}(),function(){"use strict";function a(a,b,c,d){return{restrict:"E",scope:{},transclude:!0,link:function(e,f,g){function h(f){a.require(["esri/InfoTemplate","esri/layers/FeatureLayer","esri/map","esri/renderers/HeatmapRenderer","esri/tasks/FeatureSet","esri/geometry/Point","esri/symbols/SimpleMarkerSymbol","esri/Color","esri/graphic","esri/SpatialReference","esri/graphicsUtils"],function(a,h,j,k,l,m,n,o,p,q,r){function s(){if(e.facet=e.response.facets[g.facetName],null!=e.facet){i?f.removeLayer(e.heatmapFeatureLayer):i=!0;var a,d,j,s=[],t=new l,u=new q(4326),v=(new n).setStyle(n.STYLE_SQUARE).setColor(new o([255,0,0,.5]));angular.forEach(e.facet.filters,function(b,e){var f=c("actualValue")(b.val),g=f.split(","),h=g[0].trim(),i=g[1].trim();h=parseFloat(h),i=parseFloat(i),a=new m(i,h,u),d={OBJECTID:e,weight:b.count,x:i,y:h},j=new p(a,v,d),s.push(j)}),t.features=s,t.geometryType="esriGeometryPoint";var w={objectIdField:"OBJECTID",layerDefinition:{geometryType:"esriGeometryPoint",fields:[{name:"OBJECTID",type:"esriFieldTypeOID"},{name:"weight",type:"esriFieldTypeDouble"},{name:"x",type:"esriFieldTypeDouble"},{name:"y",type:"esriFieldTypeDouble"}]},featureSet:t},x={mode:h.MODE_SNAPSHOT,outFields:["weight"]};e.heatmapFeatureLayer=new h(w,x);var y=new k({field:"weight"});e.heatmapFeatureLayer.setRenderer(y),f.addLayer(e.heatmapFeatureLayer),b(function(){var a=r.graphicsExtent(t.features);f.setExtent(a,!0)},0)}}e.esri={},e.response=d.getResponse(g.response),null!=e.response&&s(),e.$on(g.response+"_updated",function(a,b){e.response=b,s()})})}var i=!1;e.loaded=!1,e.map={},g.javascriptApiUrl=null==g.javascriptApiUrl?"//js.arcgis.com/3.15compact":g.javascriptApiUrl,g.basemap=null==g.basemap?"topo":g.basemap,a.bootstrap({url:g.javascriptApiUrl}).then(function(){e.loaded=!0,e.map.options={basemap:g.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"}},function(){e.loaded=!0,g.basemap=null==g.basemap?"topo":g.basemap,e.map.options={basemap:g.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"}}),e.onMapLoad=h},template:function(a,b){var c=Math.floor(1e3*Math.random()+1);b.height=null==b.height?"400px":b.height,b.width=null==b.width?"100%":b.width;var d="<style>.map"+c+"{height:"+b.height+"; width:"+b.width+';}</style><div class="map'+c+'" style="height:'+b.height+"; width:"+b.width+'; position:relative;"><esri-map id="esrimap"style="height: 100%; width: 100%;" map-options="map.options" ng-if="loaded" load="onMapLoad"></esri-map></div>';return d}}}angular.module("lightning").directive("esriHeatmap",a),a.$inject=["esriLoader","$timeout","$filter","ResponseService"]}(),function(){"use strict";function a(){var a={restrict:"E",template:function(a,b){var c="";return"true"==b.toggleLayers&&(c+='<style>#layerListPane{width:200px !important;}</style><div id="layerListPane" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:\'right\'"  style="position: absolute;right: 0px;z-index: 100;"><div id="layerList"></div></div>'),c}};return a}angular.module("lightning").directive("esriWebmap",a)}();